<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Downloads | Linux Labs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body { background:#f5f7fb; font-family:'Segoe UI',sans-serif; }
    .navbar { background:linear-gradient(90deg,#004aad,#0078d4); box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .navbar-brand { color:#fff!important; font-weight:600; }
    .folder-card {
      background:#fff; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.08);
      padding:15px; margin-bottom:20px;
    }
    h5.division-title { color:#004aad; font-weight:600; }
    .btn-custom { min-width:220px; }
    .list-group-item { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    .last-updated { font-size: 0.8rem; color: #6c757d; margin-left: 8px; }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark">
    <div class="container-fluid">
      <span class="navbar-brand"><i class="bi bi-download"></i> Linux Labs â€“ Admin Downloads</span>
      <div class="d-flex gap-2">
        {% if role != 'download' %}
          <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-light btn-sm">
            <i class="bi bi-speedometer2"></i> Back to Dashboard
          </a>
        {% endif %}
        <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-light btn-sm">
          <i class="bi bi-box-arrow-right"></i> Logout
        </a>
      </div>
    </div>
  </nav>

  <div class="container my-4">

    {% if role in ["main"] %}
      <div class="d-flex justify-content-center gap-3 mb-4 flex-wrap">
        <a href="{{ url_for('admin_download_all') }}" class="btn btn-success btn-lg btn-custom">
          <i class="bi bi-archive"></i> Download All Divisions ZIP
        </a>
        <a href="{{ url_for('admin_download_stockist_master') }}" class="btn btn-primary btn-lg btn-custom">
          <i class="bi bi-file-earmark-excel"></i> Download All Divisions Excel
        </a>
      </div>
    {% elif role == "division" %}
      <div class="d-flex justify-content-center mb-4">
        <a href="{{ url_for('admin_download_stockist_master', division=divisions[0].name) }}" class="btn btn-primary btn-lg btn-custom">
          <i class="bi bi-file-earmark-excel"></i> Download {{ divisions[0].name }} Excel
        </a>
      </div>
    {% endif %}

    {% if divisions %}
      {% for div in divisions %}
        <div class="folder-card">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="division-title mb-0"><i class="bi bi-folder-fill"></i> {{ div.name }}</h5>
            <div class="d-flex gap-2">
              {% if role in ["main","division","download"] %}
                <!-- All States ZIP for this division (main & division & download should be able to download) -->
                <a href="{{ url_for('admin_download_division_all_states', division=div.name) }}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-archive"></i> {{ div.name }} - All States ZIP
                </a>
              {% endif %}
              <a href="{{ url_for('admin_download_stockist_master', division=div.name) }}" class="btn btn-outline-success btn-sm">
                <i class="bi bi-file-earmark-excel"></i> {{ div.name }} Excel
              </a>
            </div>
          </div>
          <hr>
          {% if div.states %}
            <ul class="list-group">
              {% for state in div.states %}
              <li class="list-group-item">
                <div>
                  <i class="bi bi-geo-alt-fill text-primary"></i>
                  <strong>{{ state.name }}</strong>
                  {% if state.last_updated %}
                    <span class="last-updated">ðŸ•’ Last Updated: {{ state.last_updated }}</span>
                  {% endif %}
                </div>
                <div class="d-flex gap-2">
                  <a href="{{ url_for('admin_downloads_state', division=div.name, state=state.name, kind='AWS') }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-cloud-arrow-down"></i> AWS Folder
                  </a>
                  <a href="{{ url_for('admin_downloads_state', division=div.name, state=state.name, kind='SSS') }}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-cloud-arrow-down"></i> SSS Folder
                  </a>
                </div>
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">No states found under this division yet.</p>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <div class="alert alert-warning text-center">No uploaded folders found yet.</div>
    {% endif %}
  </div>
</body>
</html>
